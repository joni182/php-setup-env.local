# Set up Mysql 
# https://medium.com/@kelom.x/ansible-mysql-installation-2513d0f70faf
- name: setup Mysql with db db and remote login
  become: yes
  hosts: localhost
  tasks:
    - name: Installing Mysql  and dependencies
      package:
       name: "{{item}}"
       state: present
       update_cache: yes
      loop:
        - mysql-server
        - mysql-client 
        - python3-mysqldb
        - libmysqlclient-dev
      become: yes    
    - name: start and enable mysql service
      service:
        name: mysql
        state: started
        enabled: yes    
    - name: creating mysql user
      mysql_user:
        name: root
        password: root
        login_user: root
        login_unix_socket: /var/run/mysqld/mysqld.sock
      when: mysql_root_password is defined and mycnf.stat.exists == false
    - name: Create database
      mysql_db:
        name: localhost
        login_host: localhost
        login_user: root
        login_password: root
        state: present
      notify:
        - Restart mysql  
  handlers:
    - name: Restart mysql
      service:
        name: mysql
        state: restarted
# Set up PHP
- name: Set up PHP
  hosts: localhost
  vars:   
    mysql_root_password: root
  become: true
  tasks:
  - name: install git
    apt: name=git state=present
  - name: install vim
    apt: name=vim state=present
  - name: Installation install software-properties-common
    apt: name=software-properties-common
  - name: "Repo PHP 7.4"
    apt_repository:
      repo="ppa:ondrej/php"
  - name: "Updating the repo"
    apt: update_cache=yes
  - name: Installation PHP 7.4
    apt: name=php7.4 state=present
  - name: install lamp stack
    apt:
      pkg:
        - php5.6-mysql
        - php5.6-curl
        - php5.6-json
        - php5.6-cgi
        - php5.6-xsl
        - php5.6-cgi
        - php5.6-gd
        - php5.6-mbstring
        - php5.6-zip
        - php5.6-xmlrpc
        - php5.6-soap
        - php5.6-intl
        - php7.4-mysql
        - php7.4-curl
        - php7.4-json
        - php7.4-cgi
        - php7.4-xsl
        - php7.4-cgi
        - php7.4-gd
        - php7.4-mbstring
        - php7.4-zip
        - php7.4-xmlrpc
        - php7.4-soap
        - php7.4-intl
        - libapache2-mod-php
      state: present
      update_cache: yes